<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Bytagramm.ViewModels"
             xmlns:communitymodel="clr-namespace:Bytagramm.Dto.Community"
             xmlns:postmodel="clr-namespace:Bytagramm.Dto.Post"
             x:DataType="viewmodel:HomeViewModel"
             x:Class="Bytagramm.HomePage">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Profile"
                     IconImageSource="goose_icon.png"
                     Command="{Binding OpenProfileCommand}" />
    </ContentPage.ToolbarItems>

    <Grid Padding="10" ColumnSpacing="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="150" />
            <!-- Communities Panel -->
            <ColumnDefinition Width="*" />
            <!-- Posts -->
        </Grid.ColumnDefinitions>

        <!-- Left column â€” Communities -->
        <StackLayout Grid.Column="0">
            <Label Text="Communities"
                   FontSize="18"
                   FontAttributes="Bold"
                   Margin="0,0,0,10" />

            <CollectionView ItemsSource="{Binding SubscribedCommunities}"
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding OpenCommunityCommand}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="communitymodel:CommunityDto">
                        <Frame Padding="5" Margin="0,5"
                               HasShadow="True"
                               CornerRadius="8"
                               BackgroundColor="#f3f3f3">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={RelativeSource Mode=FindAncestor, AncestorType={x:Type ContentPage}}, Path=BindingContext.OpenCommunityCommand}"
                                    CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                            <Label Text="{Binding Title}"
                                   FontSize="14"
                                   TextColor="#000"/>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Create Community Button -->
            <Button Text="Create community"
                    Command="{Binding CreateCommunityCommand}"
                    BackgroundColor="#FF4500"
                    TextColor="White"
                    FontAttributes="Bold"
                    CornerRadius="8"
                    HeightRequest="45"
                    HorizontalOptions="FillAndExpand"/>
        </StackLayout>

        <!-- Posts -->
        <StackLayout Grid.Column="1">
            <Label Text="Feed"
                   FontSize="20"
                   FontAttributes="Bold"
                   Margin="0,0,0,10" />

            <CollectionView ItemsSource="{Binding Posts}"
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding OpenPostCommand}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="postmodel:PostDto">
                        <Frame Padding="5" Margin="0,5"
                               HasShadow="True"
                               CornerRadius="8"
                               BackgroundColor="#f3f3f3">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={RelativeSource Mode=FindAncestor, AncestorType={x:Type ContentPage}}, Path=BindingContext.OpenPostCommand}"
                                    CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                            <Label Text="{Binding Title}"
                                   FontSize="14"
                                   TextColor="#000"/>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>
    </Grid>

</ContentPage>
